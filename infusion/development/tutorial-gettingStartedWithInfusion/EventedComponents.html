<!DOCTYPE html>
<html lang="en">
    <head>
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <title>Evented Components | Fluid Infusion</title>
        <link rel="stylesheet" href="../css/normalize.css">
        <link rel="stylesheet" href="../css/foundation.css">
        <link rel="stylesheet" href="../css/highlightjs-custom.css">
        <link rel="stylesheet" type="text/css" href="../lib/infusion/src/framework/preferences/css/Enactors.css" />
        <link rel="stylesheet" type="text/css" href="../lib/infusion/src/framework/preferences/css/PrefsEditor.css" />
        <link rel="stylesheet" type="text/css" href="../lib/infusion/src/framework/preferences/css/SeparatedPanelPrefsEditor.css" />
        <link rel="stylesheet" href="../css/infusion-docs.css">

        <link rel="icon" type="image/png" href="../images/favico.png">

        <script type="text/javascript" src="../lib/infusion/infusion-uio.js"></script>
    </head>
    <body class="infusion-docs">

        <div class="container infusion-docs-container">

            <!-- BEGIN markup for Preference Editor -->
            <div class="flc-prefsEditor-separatedPanel fl-prefsEditor-separatedPanel">
                <!-- This is the div that will contain the Preference Editor component -->
                <div class="flc-slidingPanel-panel flc-prefsEditor-iframe"></div>

                <!-- This div is for the sliding panel that shows and hides the Preference Editor controls -->
                <div class="fl-panelBar">
                    <span class="fl-prefsEditor-buttons">
                        <button id="reset" class="flc-prefsEditor-reset fl-prefsEditor-reset"><span class="fl-icon-undo"></span> Reset</button>
                        <button id="show-hide" class="flc-slidingPanel-toggleButton fl-prefsEditor-showHide"> Show/Hide</button>
                    </span>
                </div>
            </div>
            <!-- END markup for Preference Editor -->

            <script type="text/javascript">
                fluid.uiOptions.prefsEditor(".flc-prefsEditor-separatedPanel", {
                    "templatePrefix": "../lib/infusion/src/framework/preferences/html/",
                    "messagePrefix": "../lib/infusion/src/framework/preferences/messages/",
                    "tocTemplate": "../lib/infusion/src/components/tableOfContents/html/TableOfContents.html"
                });
            </script>

            <header class="row infusion-docs-header">
                <div class="infusion-docs-fluidLogo small-12 medium-3 column">
                    <a class="infusion-docs-fluidLogoText" href="../index.html" title="Infusion">infusion</a>
                </div>

                <nav class="small-12 medium-9 column">
                    <a href="../index.html" title="Infusion">Infusion</a>
                    <a href="../index-tutorials.html" title="Tutorials">Tutorials</a>
                    <a href="../index-api.html" title="A P I">API</a>
                </nav>
            </header>

            <div class="row infusion-docs-mainBody">
                <nav class="infusion-docs-TOC small-12 medium-3 column">
                    
                        
                        
                    
                        
                        
                            <span class="infusion-docs-category">Tutorials</span>
                            
                                <span class="infusion-docs-sectionName">Getting Started</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="GettingStartedWithInfusion.html"><span class="infusion-docs-TOC-pageName">Getting started with Infusion</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="SetUpYourEnvironment.html"><span class="infusion-docs-TOC-pageName">Set up your environment</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="DefineANamespaceAndCreateAClosure.html"><span class="infusion-docs-TOC-pageName">Define a namespace and create a closure</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="PickAComponentType.html"><span class="infusion-docs-TOC-pageName">Pick a component type</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="BasicComponentCreation-LittleComponents.html"><span class="infusion-docs-TOC-pageName">Basic Component Creation - Little Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ModelComponents.html"><span class="infusion-docs-TOC-pageName">Model Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <span class="infusion-docs-TOC-pageName">Evented Components</span>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ViewComponents.html"><span class="infusion-docs-TOC-pageName">View Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="RendererComponents.html"><span class="infusion-docs-TOC-pageName">Renderer Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Subcomponents.html"><span class="infusion-docs-TOC-pageName">Subcomponents</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Preferences Editor</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-creatingAPreferencesEditorUsingThePreferencesFramework/CreatingAPreferencesEditorUsingThePreferencesFramework.html"><span class="infusion-docs-TOC-pageName">Creating a preferences Editor Using the Preferences Framework</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-creatingAPreferencesEditorUsingThePreferencesFramework/CreatingAPrimarySchema.html"><span class="infusion-docs-TOC-pageName">Creating a Primary Schema</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-creatingAPreferencesEditorUsingThePreferencesFramework/CreatingPanels.html"><span class="infusion-docs-TOC-pageName">Creating Panels</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-creatingAPreferencesEditorUsingThePreferencesFramework/CreatingEnactors.html"><span class="infusion-docs-TOC-pageName">Creating Enactors</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-creatingAPreferencesEditorUsingThePreferencesFramework/CreatingAnAuxiliarySchema.html"><span class="infusion-docs-TOC-pageName">Creating an Auxiliary Schema</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-creatingAPreferencesEditorUsingThePreferencesFramework/InstantiatingThePreferencesEditor.html"><span class="infusion-docs-TOC-pageName">Instantiating the Preferences Editor</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-creatingAPreferencesEditorUsingThePreferencesFramework/InstantiatingTheEnhancerAndSettingsStoreOnly.html"><span class="infusion-docs-TOC-pageName">Instantiating the Enhancer and Settings Store Only</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-creatingAPreferencesEditorUsingThePreferencesFramework/StylingThePreferencesEditor.html"><span class="infusion-docs-TOC-pageName">Styling the Preferences Editor</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../to-do/AddingPrefsEditorToSite.html"><span class="infusion-docs-TOC-pageName">Adding a Basic Preferences Editor to a Site</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../to-do/WorkingWithPrefsEditorOnSite.html"><span class="infusion-docs-TOC-pageName">Working With A Preferences Editor On Your Site</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-usingStringTemplates/UsingStringTemplates.html"><span class="infusion-docs-TOC-pageName">Using String Templates</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Creating an Adjuster UI</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-creatingANewAdjusterUI/CreatingANewAdjusterUI.html"><span class="infusion-docs-TOC-pageName">Creating a New Adjuster UI</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-creatingANewAdjusterUI/HowToCreateAndUseFontIcons.html"><span class="infusion-docs-TOC-pageName">How to Create and Use Font Icons</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">User Interface Options</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-userInterfaceOptions/UserInterfaceOptions.html"><span class="infusion-docs-TOC-pageName">User Interface Options</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                        
                    
                        
                        
                    
                </nav>

                <article class="infusion-docs-mainContent small-12 medium-9 column">

                    <div class="flc-toc-tocContainer infusion-docs-toc"> </div>

                    <h1>Evented Components</h1>

                    <p class="infusion-docs-githubLink"><a href="https://github.com/fluid-project/infusion-docs/blob/master/src/documents/tutorial-gettingStartedWithInfusion/EventedComponents.md" target="_blank">Edit on GitHub</a></p>

                    

                    <div class="infusion-docs-articleBody">
                        <hr>
<p>Part of the <a href="GettingStartedWithInfusion.html">Getting Started with Infusion Tutorial</a></p>
<hr>
<p>Many times, you will be creating a component that works in an environment where other things are operating, and it will probably need to notify those other things of key <strong>events</strong> in its lifecycle. Events can be used to trigger changes in the visual appearance of a component, or actions by other components. For example:</p>
<ul>
<li>the Infusion <a href="../to-do/Reorderer.html">Reorderer</a> component provides drag-and-drop functionality for lists, grids, etc. Its operation has several key events, such as when a move is initiated, when it&#39;s completed, etc.</li>
<li>the Infusion <a href="../to-do/Uploader.html">Uploader</a> component, a queued multi-file uploader, has events including when a file is successfully added to the queue, when each file starts being uploaded, when each upload completes, etc.</li>
</ul>
<p>The Infusion Framework defines its own event system. Infusion events differ from browser events in that they are not bound to the DOM or its insfrastructure. Infusion events can be used for anything, not only user-interface related events.</p>
<h2 id="declaring-an-evented-component">Declaring an Evented Component</h2>
<p>To use events with your component is to use the <strong>eventedComponent</strong> grade. To do this:</p>
<ul>
<li>specify a grade of <code>fluid.eventedComponent</code>, and</li>
<li>include an <code>events</code> property in your defaults, listing the events your component will fire.</li>
</ul>
<pre class="highlight"><code class="hljs javascript">fluid.defaults(<span class="hljs-string">"tutorials.eventedComponent"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.eventedComponent"</span>, <span class="hljs-string">"autoInit"</span>],
    ...
    events: {
        onAnAction: <span class="hljs-literal">null</span>,
        afterAnAction: <span class="hljs-literal">null</span>,
        onAnotherAction: <span class="hljs-string">"preventable"</span>,
        afterAnotherAction: <span class="hljs-literal">null</span>
    }
});
</code></pre>
<p>The contents of the <code>events</code> object is a set of key-value pairs where the key is the event name and the value is the event type.</p>
<ul>
<li><strong>Event naming conventions</strong>: You can call your events anything you like, but Infusion has adopted the convention of prefacing events with on or after to indicate whether or not the event is being fired before some action is taken, or after the action has completed.</li>
<li><strong>Event types</strong>: If the event is a standard event defined on this component, you will normally write <code>null</code> here. Event types supported by the framework are described at the <a href="../InfusionEventSystem.html">Infusion Event System</a>. Another possibility is to inject an event appearing elsewhere in the component tree by use of an <a href="../IoCReferences.html">IoC reference</a> such as <code>{myOtherComponent}.events.myEvent</code>.</li>
</ul>
<h3 id="example-saving-and-deleting">Example: Saving and Deleting</h3>
<p>Suppose you&#39;re creating a component that is responsible for managing records of some kind, or editing documents. An application like that is going to allow users to save their edits or remove the record altogether. You might create the following events for these actions:</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// Declare the events in the defaults</span>
fluid.defaults(<span class="hljs-string">"tutorials.recordEditor"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.eventedComponent"</span>, <span class="hljs-string">"autoInit"</span>],
    ...
    events: {
        afterSave: <span class="hljs-literal">null</span>,
        onRemove: <span class="hljs-string">"preventable"</span>,
        afterRemove: <span class="hljs-literal">null</span>
    }
});
</code></pre>
<h2 id="firing-events">Firing Events</h2>
<p>When you declare your component to be an <strong>evented</strong> component, the Framework will automatically set up event firers for all of your listed events. These will be attached to an object on your component called <code>events</code> and provide an API (and reference target) for you to fire events and add or remove listeners.</p>
<h3 id="example-saving-and-deleting">Example: Saving and Deleting</h3>
<p>Our record editor component will likely have public methods for the saving and removing of records. We will define these methods using the framework facility for <a href="../Invokers.html">invokers</a>. These methods will be responsible for firing the events.</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// Declare the events in the defaults</span>
fluid.defaults(<span class="hljs-string">"tutorials.recordEditor"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.eventedComponent"</span>, <span class="hljs-string">"autoInit"</span>],
    events: {
        afterSave: <span class="hljs-literal">null</span>,
        onRemove: <span class="hljs-string">"preventable"</span>,
        afterRemove: <span class="hljs-literal">null</span>
    },
    invokers: {
        save: {
            funcName: <span class="hljs-string">"tutorials.recordEditor.save"</span>,
            args: <span class="hljs-string">"{that}"</span>
        },
        remove: {
            funcName: <span class="hljs-string">"tutorials.recordEditor.remove"</span>,
            args: <span class="hljs-string">"{that}"</span>
        }
    }
});

<span class="hljs-comment">// Add public methods that will fire events when they do things</span>
tutorials.recordEditor.save = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(that)</span> {</span>
    <span class="hljs-comment">// save stuff</span>
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// let anyone listening know the save has happened:</span>
    that.events.afterSave.fire();
};

tutorials.recordEditor.remove = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(that)</span> {</span>
    <span class="hljs-comment">// see if anyone listening objects to the removal:</span>
    <span class="hljs-keyword">var</span> prevent = that.events.onRemove.fire();
    <span class="hljs-keyword">if</span> (prevent === <span class="hljs-literal">false</span>) {
        <span class="hljs-comment">// a listener prevented the move, don't do it</span>
    }
    <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// no one objects, go ahead and remove</span>
        <span class="hljs-comment">// ...</span>
        <span class="hljs-comment">// let listeners know that the remove has completed</span>
        that.events.afterRemove.fire();
    }
};
</code></pre>
<h2 id="example-currency-converter">Example: Currency Converter</h2>
<p>Component grades can be combined, if necessary. Suppose we wish to add events to the model-bearing currency converter shown on the previous page. We can declare the component to be both a model component and an evented component by using the standard framework grade <code>fluid.standardComponent</code> which is a built-in defined as the combination of <code>fluid.eventedComponent</code> and <code>fluid.modelComponent</code>. The user can define such combinations themselves by just adding the list of grades directly into <code>gradeNames</code>.</p>
<h3 id="compatibility-note-">Compatibility note:</h3>
<p>During the transition period between Infusion 1.5 and Infusion 2.0 it is recommended that authors of new code use the names <code>fluid.modelRelayComponent</code> and <code>fluid.standardRelayComponent</code> rather than <code>fluid.modelComponent</code> and <code>fluid.standardComponent</code> respectively. See <a href="../ComponentGrades.html">Component Grades</a> for details.</p>
<pre class="highlight"><code class="hljs javascript">fluid.defaults(<span class="hljs-string">"tutorials.currencyConverter"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.standardComponent"</span>, <span class="hljs-string">"autoInit"</span>],
    model: {
        rates: {
            euro: <span class="hljs-number">0.712</span>,
            yen: <span class="hljs-number">81.841</span>,
            yuan: <span class="hljs-number">6.609</span>,
            usd: <span class="hljs-number">1.02</span>,
            rupee: <span class="hljs-number">45.789</span>
        },
        currentSelection: <span class="hljs-string">"euro"</span>,
        amount: <span class="hljs-number">0</span>,
        convertedAmount: <span class="hljs-number">0</span>
    },
    events: {
        conversionUpdated: <span class="hljs-literal">null</span>
    },
    invokers: {
        updateCurrency: {
            changePath: <span class="hljs-string">"currentSelection"</span>,
            value: <span class="hljs-string">"{arguments}.0"</span>
        },
        updateRate: {
            funcName: <span class="hljs-string">"tutorials.currencyConverter.updateRate"</span>,
            args: [<span class="hljs-string">"{that}"</span>, <span class="hljs-string">"{arguments}.0"</span>, <span class="hljs-string">"{arguments}.1"</span>] <span class="hljs-comment">// currency, newRate</span>
        },
        updateAmount: {
            funcName: <span class="hljs-string">"tutorials.currencyConverter.updateAmount"</span>,
            args: [<span class="hljs-string">"{that}"</span>, <span class="hljs-string">"{arguments}.0"</span>] <span class="hljs-comment">// amount</span>
    },
    modelListeners: {
        convertedAmount: {
            funcName: <span class="hljs-string">"{that}.events.conversionUpdated.fire"</span>,
            args: <span class="hljs-string">"{change}.value"</span>
        }
    }
});

tutorials.currencyConverter.updateRate = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(that, currency, newRate)</span> {</span>
    that.applier.change([<span class="hljs-string">"rates"</span>, currency], newRate);
};

tutorials.currencyConverter.updateAmount = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(that, amount)</span> {</span>
    <span class="hljs-keyword">var</span> convertedAmount = amount * that.model.rates[that.model.currentSelection];
    that.applier.change(<span class="hljs-string">"convertedAmount"</span>, convertedAmount);
};
</code></pre>
<h2 id="notes-on-declarative-programming-">Notes on declarative programming:</h2>
<p>It&#39;s a long-term goal of the Infusion framework that as much logic as possible can be expressed as declarative configuration, rather than as manual JavaScript code. By comparing in this page&#39;s history, you can see that since it was first written, the majority of the implementation can now be expressed in configuration (e.g., the invoker definitions, the implementation of <code>updateCurrency</code> and the model listener). In future versions of Infusion, 100% of this component will be expressible as configuration - it can&#39;t be handled by the current framework because of the indirection into the model from itself (the fact that <code>updateRate</code> and <code>updateAmount</code> use <code>model.currentSelection</code> and <code>currency</code> as model indexes). You can track this work at <a href="http://issues.fluidproject.org/browse/FLUID-5286">FLUID-5286</a>.</p>
<p>Next: <a href="ViewComponents.html">View Components</a></p>

                    </div>

                </article>

            </div>

            <footer class="row infusion-docs-footer">
                <p class="infusion-docs-footerInfusion">Infusion is created by the <a href="http://fluidproject.org/" target="_blank">Fluid Project</a>,<br/>
                a project of the <a href="http://idrc.ocad.ca/" target="_blank">Inclusive Design Research Centre</a> at <a href="http://www.ocadu.ca/" target="_blank">OCAD University</a>, funded by a grant from <a href="http://www.mellon.org/" target="_blank">The Andrew W. Mellon Foundation</a>.</p>
            </footer>

        </div> <!-- end container -->

    </body>
</html>
