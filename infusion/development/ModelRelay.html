<!DOCTYPE html>
<html lang="en">
    <head>
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <title>Model Relay | Fluid Infusion</title>
        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/foundation.css">
        <link rel="stylesheet" href="css/highlightjs-custom.css">
        <link rel="stylesheet" type="text/css" href="lib/infusion/src/framework/preferences/css/Enactors.css" />
        <link rel="stylesheet" type="text/css" href="lib/infusion/src/framework/preferences/css/PrefsEditor.css" />
        <link rel="stylesheet" type="text/css" href="lib/infusion/src/framework/preferences/css/SeparatedPanelPrefsEditor.css" />
        <link rel="stylesheet" href="css/infusion-docs.css">

        <link rel="icon" type="image/png" href="images/favico.png">

        <script type="text/javascript" src="lib/infusion/infusion-uio.js"></script>
    </head>
    <body class="infusion-docs">

        <div class="container infusion-docs-container">

            <!-- BEGIN markup for Preference Editor -->
            <div class="flc-prefsEditor-separatedPanel fl-prefsEditor-separatedPanel">
                <!-- This is the div that will contain the Preference Editor component -->
                <div class="flc-slidingPanel-panel flc-prefsEditor-iframe"></div>

                <!-- This div is for the sliding panel that shows and hides the Preference Editor controls -->
                <div class="fl-panelBar">
                    <span class="fl-prefsEditor-buttons">
                        <button id="reset" class="flc-prefsEditor-reset fl-prefsEditor-reset"><span class="fl-icon-undo"></span> Reset</button>
                        <button id="show-hide" class="flc-slidingPanel-toggleButton fl-prefsEditor-showHide"> Show/Hide</button>
                    </span>
                </div>
            </div>
            <!-- END markup for Preference Editor -->

            <script type="text/javascript">
                fluid.uiOptions.prefsEditor(".flc-prefsEditor-separatedPanel", {
                    "templatePrefix": "lib/infusion/src/framework/preferences/html/",
                    "messagePrefix": "lib/infusion/src/framework/preferences/messages/",
                    "tocTemplate": "lib/infusion/src/components/tableOfContents/html/TableOfContents.html"
                });
            </script>

            <header class="row infusion-docs-header">
                <div class="infusion-docs-fluidLogo small-12 medium-3 column">
                    <a class="infusion-docs-fluidLogoText" href="index.html" title="Infusion">infusion</a>
                </div>

                <nav class="small-12 medium-9 column">
                    <a href="index.html" title="Infusion">Infusion</a>
                    <a href="index-tutorials.html" title="Tutorials">Tutorials</a>
                    <a href="index-api.html" title="A P I">API</a>
                </nav>
            </header>

            <div class="row infusion-docs-mainBody">
                <nav class="infusion-docs-TOC small-12 medium-3 column">
                    
                        
                        
                            <span class="infusion-docs-category">Infusion</span>
                            
                                <span class="infusion-docs-sectionName">Components</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="FrameworkConcepts.html"><span class="infusion-docs-TOC-pageName">Framework Concepts</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="UnderstandingInfusionComponents.html"><span class="infusion-docs-TOC-pageName">Understanding Infusion Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ComponentOptionsAndDefaults.html"><span class="infusion-docs-TOC-pageName">Understanding Component Options And Their Defaults</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ComponentConfigurationOptions.html"><span class="infusion-docs-TOC-pageName">Component Configuration Options</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ComponentGrades.html"><span class="infusion-docs-TOC-pageName">Component Grades</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="OptionsMerging.html"><span class="infusion-docs-TOC-pageName">Options Merging</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ComponentLifecycle.html"><span class="infusion-docs-TOC-pageName">Component Lifecycle</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="DOMBinder.html"><span class="infusion-docs-TOC-pageName">DOM Binder</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Inversion of Control</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="HowToUseInfusionIoC.html"><span class="infusion-docs-TOC-pageName">How To Use Infusion IoC</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="SubcomponentDeclaration.html"><span class="infusion-docs-TOC-pageName">Subcomponent Declaration</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Contexts.html"><span class="infusion-docs-TOC-pageName">Contexts</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Invokers.html"><span class="infusion-docs-TOC-pageName">Invokers</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ExpansionOfComponentOptions.html"><span class="infusion-docs-TOC-pageName">Expansion Of Component Options</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="IoCSS.html"><span class="infusion-docs-TOC-pageName">IoCSS</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="DeclarativeThisismInIoC.html"><span class="infusion-docs-TOC-pageName">Declarative this-ism In IoC</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="IoCReferences.html"><span class="infusion-docs-TOC-pageName">IoC References</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Events</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="Events.html"><span class="infusion-docs-TOC-pageName">Events</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="InfusionEventSystem.html"><span class="infusion-docs-TOC-pageName">Infusion Event System</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="EventInjectionAndBoiling.html"><span class="infusion-docs-TOC-pageName">Event injection and boiling</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">ChangeApplier</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="ChangeApplier.html"><span class="infusion-docs-TOC-pageName">ChangeApplier</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Renderer</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="Renderer.html"><span class="infusion-docs-TOC-pageName">Renderer</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="HowToUseTheRenderer.html"><span class="infusion-docs-TOC-pageName">How To Use the Renderer</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="RendererComponentTrees.html"><span class="infusion-docs-TOC-pageName">Renderer Component Trees</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ProtoComponentTypes.html"><span class="infusion-docs-TOC-pageName">ProtoComponent Types</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="RendererComponentTreeExpanders.html"><span class="infusion-docs-TOC-pageName">Renderer Component Tree Expanders</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Cutpoints.html"><span class="infusion-docs-TOC-pageName">Cutpoints</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="RendererComponents.html"><span class="infusion-docs-TOC-pageName">Renderer Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="RendererDecorators.html"><span class="infusion-docs-TOC-pageName">Renderer Decorators</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Preferences Framework</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="PreferencesFramework.html"><span class="infusion-docs-TOC-pageName">Preferences Framework</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="PreferencesEditor.html"><span class="infusion-docs-TOC-pageName">Preferences Editor</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Builder.html"><span class="infusion-docs-TOC-pageName">Builder</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="PrimarySchemaForPreferencesFramework.html"><span class="infusion-docs-TOC-pageName">Primary Schema</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="AuxiliarySchemaForPreferencesFramework.html"><span class="infusion-docs-TOC-pageName">Auxiliary Schema</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ConnectingThePartsOfAPreferencesEditor.html"><span class="infusion-docs-TOC-pageName">Connecting the Parts of a Preferences Editor</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Enactors.html"><span class="infusion-docs-TOC-pageName">Enactors</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Panels.html"><span class="infusion-docs-TOC-pageName">Panels</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="CompositePanels.html"><span class="infusion-docs-TOC-pageName">Composite Panels</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ConditionalSubpanels.html"><span class="infusion-docs-TOC-pageName">Conditional Subpanels</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="LocalizationInThePreferencesFramework.html"><span class="infusion-docs-TOC-pageName">Localization in the Preferences Framework</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">General</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <span class="infusion-docs-TOC-pageName">Model Relay</span>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ProgressiveEnhancement.html"><span class="infusion-docs-TOC-pageName">Progressive Enhancement</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ClassNameConventions.html"><span class="infusion-docs-TOC-pageName">Class Name Conventions</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="IoCTestingFramework.html"><span class="infusion-docs-TOC-pageName">IoC Testing Framework</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Migrating to Infusion 1.5</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="APIChangesFrom1_4To1_5.html"><span class="infusion-docs-TOC-pageName">API Changes from 1.4 to 1.5</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="DeprecationsIn1_5.html"><span class="infusion-docs-TOC-pageName">Deprecations In 1.5</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="tutorial-migratingToInfusion1.5/UIOptionsMigration.html"><span class="infusion-docs-TOC-pageName">UI Options Migration</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="tutorial-migratingToInfusion1.5/PagerMigration.html"><span class="infusion-docs-TOC-pageName">Pager Migration</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Migrating to Infusion 2.0</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="APIChangesFrom1_5To2_0.html"><span class="infusion-docs-TOC-pageName">API Changes from 1.5 to 2.0</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                        
                    
                        
                        
                    
                        
                        
                    
                </nav>

                <article class="infusion-docs-mainContent small-12 medium-9 column">

                    <div class="flc-toc-tocContainer infusion-docs-toc"> </div>

                    <h1>Model Relay</h1>

                    <p class="infusion-docs-githubLink"><a href="https://github.com/fluid-project/infusion-docs/blob/master/src/documents/ModelRelay.md" target="_blank">Edit on GitHub</a></p>

                    

                    <div class="infusion-docs-articleBody">
                        <p>The Infusion Model Relay system is a powerful scheme for supplying declarative configuration which specifies rules for keeping multiple pieces of model state around the component tree automatically up to date with each other&#39;s changes. Because each model relay rule supplies a link between an inner core of models scattered around the component tree, around which other listeners in the periphery of each component (generally, in its view layer) only react after all updates have finished propagating in the model layer, we sometimes refer to the complete set of these linked models as the <em>model skeleton</em> of the component tree.</p>
<h3 id="two-styles-for-configuring-model-relay">Two Styles for Configuring Model Relay</h3>
<p>There are two primary styles of configuration for setting up model relay - firstly, using the <em>implicit syntax</em> which just consists of <a href="IoCReferences.html">IoC References</a> from the model configuration for one model-bearing component to another - that is, in the component&#39;s configuration under the top-level model entry. Secondly, the <em>explicit syntax</em> involves an entry in the component&#39;s top-level <code>modelRelay</code> entry expressing a more complex rule, most likely involving some form of <a href="to-do/ModelTransformation.html">Model Transformation</a> to apply during the relay process. Both of these styles will set up a permanent and bidirectional relationship between the two models at the ends of the relay - the relationship will be established as the component(s) construct (during the <em><a href="#the-initial-transaction">initial transaction</a></em>), and will persist until one of the components at the endpoints is destroyed.</p>
<h3 id="how-model-relay-updates-propagate">How Model Relay Updates Propagate</h3>
<p>A set of models which are linked by relay rules are called a <em><strong>model skeleton</strong></em>. Whenever an update is received to any model which is part of the skeleton (via its <a href="ChangeApplier.html">ChangeApplier</a>), a &quot;transaction&quot; begins in order to propagate it to all the related models to which it should be synchronised. The framework will keep propagating the change to all the models in the skeleton until they have all been brought up to date - however, these updates will initially occur privately, within the transaction and any external listeners will not be notified during the update process, in order to not become confused by receiving multiple notifications as the synchronisation occurs. Only once the framework has computed final synchronised values for all of the models in the skeleton will the transaction end, and then all listeners (via their respective ChangeAppliers) will be notified all at once.</p>
<h3 id="the-initial-transaction">The Initial Transaction</h3>
<p>Whenever a new model-bearing component (or an entire tree of model-bearing components) constructs, there will be a particular large style of update transaction known as an <strong>initial transaction</strong>.   This is extremely similar to any other synchronisation transaction caused by a model relay update, although it will typically involve more data since all of the initial values of all the involved models must be taken into account - these result from any of the normal sources for component configuration, including <a href="https://github.com/fluid-project/infusion/blob/infusion-1.5/src/framework/core/js/Fluid.js#L1519-L1539">defaults</a>, user-supplied values, <a href="IoCSS.html">distributed</a> options, etc.. During the initial transaction, any declaratively registered listeners will observe all of the new models go through the transition from holding their primordial value of <code>undefined</code> to holding their correct synchronised initial values. As with any other relay update transaction, this will appear to all the observers to occur in a single step even though from the point of view of the framework it may be a complex process involving many passes through the components.</p>
<h2 id="implicit-model-relay-style">Implicit Model Relay style</h2>
<p>This is the most straightforward style for setting up model relay. This takes the form of a simple <a href="IoCReferences.html">IoC Reference</a> between one component&#39;s model and other. Here is a component which has a child component which sets up a model relay relationship with it:</p>
<pre class="highlight"><code class="hljs javascript">fluid.defaults(<span class="hljs-string">"examples.implicitModelRelay"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.standardRelayComponent"</span>, <span class="hljs-string">"autoInit"</span>],
    model: {
         parentValue: <span class="hljs-number">3</span>
    },
    components: {
        child: {
            type: <span class="hljs-string">"fluid.standardRelayComponent"</span>,
            options: {
                model: { <span class="hljs-comment">// implicit relay rule setting up synchronisation with one field in parent's model</span>
                    childValue: <span class="hljs-string">"{examples.implicitModelRelay}.model.parentValue"</span>
                }
            }
        }
    }
});

<span class="hljs-keyword">var</span> that = examples.implicitModelRelay();
console.log(that.child.model.childValue); <span class="hljs-comment">// 3 - parent's value has been synchronised to child on construction</span>
</code></pre>
<p>The IoC expression <code>{examples.implicitModelRelay}.model.parentValue</code> here refers from one field of the child&#39;s model called <code>childValue</code> to one field of the parent&#39;s model called <code>parentValue</code>. This sets up a permanent model relay linking these two fields. From the construction point onwards, the framework will ensure that all updates made to one field will be reflected in the other. For example, here are some further pieces of code we could write, following on from the above example - these use the programmatic <a href="ChangeApplierAPI.html">ChangeApplier API</a> although in practice it is desirable to express as many such updates as declaratively as possible:</p>
<pre class="highlight"><code class="hljs javascript">that.applier.change(<span class="hljs-string">"parentValue"</span>, <span class="hljs-number">4</span>);      <span class="hljs-comment">// update the parent's model field to hold the value 4</span>
console.log(that.child.model.childValue);   <span class="hljs-comment">// 4 - The child's model value has been updated</span>
that.child.applier.change(<span class="hljs-string">"childValue"</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">// update the child's model to hold the value 5</span>
console.log(that.model.parentValue);        <span class="hljs-comment">// 5 - The parent's model value has been updated</span>
</code></pre>
<h2 id="explicit-model-relay-style">Explicit Model Relay Style</h2>
<p>This style is used when we require a <a href="to-do/ModelTransformation.html">Model Transformation</a> rule to mediate between the updates synchronising one model value with another. The simple implicit style is only capable of &quot;moving&quot; the same value between one path and another. Sometimes different models choose different strategies for representing &quot;the same value&quot; - for example, one component might represent a sound volume level on a scale of 0-100, whereas another might use a range of 0-1. The framework is capable of accommodating this kind of difference in viewpoint by allowing the user to explicitly list a transformation rule relating one model&#39;s instance of a value with another. This is done using the <code>modelRelay</code> section of a component&#39;s top-level options. Here is the layout of this block:</p>
<h3 id="model-relay-block-layout">Model Relay Block Layout</h3>
<table>
    <thead>
        <tr>
            <th>Option name</th><th>Type</th><th>Description</th><th>Example</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>source</td>
            <td>String (EL Reference or short local path)</td>
            <td>The source model path to be linked by this relay rule</td>
            <td><code>&quot;volume&quot;</code> / <code>&quot;{someComponent}.model.volume&quot;</code></td>
        </tr>
        <tr>
            <td>target</td>
            <td>String (EL Reference or short local path)</td>
            <td>The target model path to be linked by this relay rule</td>
            <td><code>&quot;volume&quot;</code> / <code>&quot;{someComponent}.model.volume&quot;</code></td>
        </tr>
        <tr>
            <td>singleTransform</td>
            <td>JSON (single <a href="to-do/ModelTransformation.html">Model Transformation</a> rule)</td>
            <td>A short form which can be used where the transformation consists of just a single Model Transformation transform rule</td>
            <td>
{
    type: &quot;fluid.linearScale&quot;,
    factor: 100
}

            </td>
        </tr>
        <tr>
            <td>transform</td>
            <td>JSON (full <a href="to-do/ModelTransformation.html">Model Transformation</a> document)</td>
            <td>A long form which allows any valid Model Transformation document to be used to mediate the relay</td>
            <td>See this <a href="http://wiki.gpii.net/index.php/Architecture_-_Available_transformation_functions">list of available transformation functions</a> for more information.</td>
        </tr>
    </tbody>
</table>

<p>Here is an example of two components linked by explicit model relay representing the situation we described earlier:</p>
<pre class="highlight"><code class="hljs javascript">fluid.defaults(<span class="hljs-string">"examples.explicitModelRelay"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.standardRelayComponent"</span>, <span class="hljs-string">"autoInit"</span>],
    model: {
        volume: <span class="hljs-number">95</span>,
    },
    components: {
        child: {
            modelRelay: {
                source: <span class="hljs-string">"{examples.explicitModelRelay}.model.volume"</span>,
                target: <span class="hljs-string">"volume"</span>,
                singleTransform: {
                    type: <span class="hljs-string">"fluid.linearScale"</span>,
                    factor: <span class="hljs-number">0.01</span>
                }
            }
        }
    }
});

<span class="hljs-keyword">var</span> that = examples.explicitModelRelay();
console.log(that.child.model.volume); <span class="hljs-comment">// 0.95 - transformed during the initial transaction to sync with outer value</span>
that.applier.change(<span class="hljs-string">"volume"</span>, <span class="hljs-number">50</span>);
console.log(that.child.model.volume); <span class="hljs-comment">// 0.5 - transformed to update with outer value</span>
that.child.applier.change(<span class="hljs-string">"volume"</span>, <span class="hljs-number">1</span>);
console.log(that.model.volume);       <span class="hljs-comment">// 100 - inverse transformed to accept update from child component</span>
</code></pre>
<p>In general those transformations which are <em><strong>invertible</strong></em> are the best choice for this kind of linkage. If the transforms are not invertible (or have no inverse defined in the framework), the updates will propagate only in one direction. This can still be highly useful.</p>
<h2 id="notes-on-future-evolution-and-some-technicalities">Notes on Future Evolution and some Technicalities</h2>
<p>For the Infusion 1.5 release we use special versions of the framework grades including the word &quot;relay&quot; in order to gain access to the model relay features described on this page - these are <code>fluid.modelRelayComponent</code>, <code>fluid.standardRelayComponent</code>, <code>fluid.viewRelayComponent</code> and <code>fluid.rendererRelayComponent</code> as described on <a href="ComponentGrades.html">Component Grades</a>. This is because the core framework implementation is in the process of being updated to this new relay-capable ChangeApplier and not all of the core components delivered with the framework have been updated to match. Before the 2.0 release the core grades will be updated, allowing the &quot;relay&quot; names to be replaced by the standard ones.</p>
<p>The use of the term &quot;transactions&quot; to describe the process by which the model skeleton updates is not entirely consistent with its use elsewhere in the industry. Those interested in more semantic and detailed discussion can consult <a href="http://wiki.fluidproject.org/display/fluid/New+Notes+on+the+ChangeApplier">New Notes on the ChangeApplier</a> which describes how the new relay-capable implementation differs from the old one, and how our approach to and thinking about coordinated model updates is different to that of other frameworks.</p>

                    </div>

                </article>

            </div>

            <footer class="row infusion-docs-footer">
                <p class="infusion-docs-footerInfusion">Infusion is created by the <a href="http://fluidproject.org/" target="_blank">Fluid Project</a>,<br/>
                a project of the <a href="http://idrc.ocad.ca/" target="_blank">Inclusive Design Research Centre</a> at <a href="http://www.ocadu.ca/" target="_blank">OCAD University</a>, funded by a grant from <a href="http://www.mellon.org/" target="_blank">The Andrew W. Mellon Foundation</a>.</p>
            </footer>

        </div> <!-- end container -->

    </body>
</html>
